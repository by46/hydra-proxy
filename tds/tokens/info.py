import struct

from tds.base import StreamSerializer
from tds.utils import b_varchar_encode
from tds.utils import us_varchar_encode


class InfoStream(StreamSerializer):
    TOKEN_TYPE = 0xAB

    def __init__(self):
        self.sql_error_number = 5701
        self.state = 2
        self.severity = 0
        self.msg = None
        self.server_name = None
        self.process_name = None
        self.line_number = 0
        super(InfoStream, self).__init__()

    def marshal(self):
        self.buf.truncate()
        self.buf.write(struct.pack('<L', self.sql_error_number))
        self.buf.write(chr(self.state))
        self.buf.write(chr(self.severity))
        self.buf.write(us_varchar_encode(self.msg))
        self.buf.write(b_varchar_encode(self.server_name))
        self.buf.write(b_varchar_encode(self.process_name))
        self.buf.write(struct.pack('<H', self.line_number))
        return super(InfoStream, self).marshal()


class Info31(StreamSerializer):
    def marshal(self):
        return '\xab\x70\x00\x45\x16\x00\x00\x02\x00\x22\x00\x43\x00\x68\x00\x61\x00\x6e\x00\x67\x00\x65\x00\x64\x00\x20\x00\x64\x00\x61\x00\x74\x00\x61\x00\x62\x00\x61\x00\x73\x00\x65\x00\x20\x00\x63\x00\x6f\x00\x6e\x00\x74\x00\x65\x00\x78\x00\x74\x00\x20\x00\x74\x00\x6f\x00\x20\x00\x27\x00\x43\x00\x54\x00\x49\x00\x27\x00\x2e\x00\x10\x53\x00\x31\x00\x44\x00\x53\x00\x51\x00\x4c\x00\x30\x00\x34\x00\x5c\x00\x45\x00\x48\x00\x49\x00\x53\x00\x53\x00\x51\x00\x4c\x00\x00\x01\x00'


class Info21(StreamSerializer):
    def marshal(self):
        return '\xab\x7a\x00\x47\x16\x00\x00\x01\x00\x27\x00\x43\x00\x68\x00\x61\x00\x6e\x00\x67\x00\x65\x00\x64\x00\x20\x00\x6c\x00\x61\x00\x6e\x00\x67\x00\x75\x00\x61\x00\x67\x00\x65\x00\x20\x00\x73\x00\x65\x00\x74\x00\x74\x00\x69\x00\x6e\x00\x67\x00\x20\x00\x74\x00\x6f\x00\x20\x00\x75\x00\x73\x00\x5f\x00\x65\x00\x6e\x00\x67\x00\x6c\x00\x69\x00\x73\x00\x68\x00\x2e\x00\x10\x53\x00\x31\x00\x44\x00\x53\x00\x51\x00\x4c\x00\x30\x00\x34\x00\x5c\x00\x45\x00\x48\x00\x49\x00\x53\x00\x53\x00\x51\x00\x4c\x00\x00\x01\x00'
